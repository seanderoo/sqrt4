<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>SQRT4  |  Koppel Docenten</title>
    <link rel="stylesheet" type="text/css" href="/stylesheet.css">
    <link rel="stylesheet" type="text/css" href="/header-stylesheet.css">
</head>
<body>
<header>
    <div th:insert="~{header::copy}">Header</div>
</header>

<h1>Koppel Docenten voor <span th:text="${cohort.getCohortNaam()}"></span></h1>


<h3>Klik op de week waarvoor je een rooster wilt maken om het rooster zonder docenten in te laden. <br>Vervolgens kun je docenten koppelen aan de vakken die in het rooster staan.</h3>
<input type="hidden" th:value="${voorkeuren}" id="voorkeuren">

<th:block th:each="week: ${weken}">
    <button class="collapsible">Week: <span th:text="${week.getWeekNummer()}"></span>   |   Data: <span th:text="${week.getMaandag().getDatum() + ' t/m ' + week.getVrijdag().getDatum()}"></span></button>
    <div class="content">
<form action="#" th:action="@{/roosteraar/docenten-koppelen-gekozen-cohort}" th:object="${cohort}" method="POST">
        <h6></h6>
        <table class="TableFormatter">
            <input name="weekId" type="hidden" th:value="${week.getId()}">
            <input name="cohortNaam" type="hidden" th:value="${cohort.getCohortNaam()}">
            <thead>
            <tr colspan="2">
                <th>Weeknummer</th>
                <th>Maandag</th>
                <th>Dinsdag</th>
                <th>Woensdag</th>
                <th>Donderdag</th>
                <th>Vrijdag</th>
            </tr>
            <tr>
                <td th:text="${week.getWeekNummer()}"></td>
                <td th:text="${week.getMaandag().getDatum()}"></td>
                <td th:text="${week.getDinsdag().getDatum()}"></td>
                <td th:text="${week.getWoensdag().getDatum()}"></td>
                <td th:text="${week.getDonderdag().getDatum()}"></td>
                <td th:text="${week.getVrijdag().getDatum()}"></td>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td rowspan="2" th:value="ochtend">9:00 - 13:00</td>
                <td th:text="${week.getMaandag().getOchtend().getVak().getVakNaam()}" id="vakMaO" th:value="${week.getMaandag().getOchtend().getVak().getVakId()}"></td>
                <td th:text="${week.getDinsdag().getOchtend().getVak().getVakNaam()}" id="vakDiO" th:value="${week.getDinsdag().getOchtend().getVak().getVakId()}"></td>
                <td th:text="${week.getWoensdag().getOchtend().getVak().getVakNaam()}" id="vakWoO" th:value="${week.getWoensdag().getOchtend().getVak().getVakId()}"></td>
                <td th:text="${week.getDonderdag().getOchtend().getVak().getVakNaam()}" id="vakDoO" th:value="${week.getDonderdag().getOchtend().getVak().getVakId()}"></td>
                <td th:text="${week.getVrijdag().getOchtend().getVak().getVakNaam()}" id="vakVrO" th:value="${week.getVrijdag().getOchtend().getVak().getVakId()}"></td>
            </tr>
            <tr>
                <td><select id="maOcht" th:name="maOch" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${MAO}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="diOcht" th:name="diOch" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${DIO}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="woOcht" th:name="woOch" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${WOO}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="doOcht" th:name="doOch" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${DOO}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="vrOcht" th:name="vrOch" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${VRO}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
            </tr>
            <tr>
                <td rowspan="2" th:value="middag">13:00 - 17:00</td>
                <td th:text="${week.getMaandag().getMiddag().getVak().getVakNaam()}" id="vakMaM" th:value="${week.getMaandag().getMiddag().getVak().getVakId()}"></td>
                <td th:text="${week.getDinsdag().getMiddag().getVak().getVakNaam()}" id="vakDiM" th:value="${week.getDinsdag().getMiddag().getVak().getVakId()}"></td>
                <td th:text="${week.getWoensdag().getMiddag().getVak().getVakNaam()}" id="vakWoM" th:value="${week.getWoensdag().getMiddag().getVak().getVakId()}"></td>
                <td th:text="${week.getDonderdag().getMiddag().getVak().getVakNaam()}" id="vakDoM" th:value="${week.getDonderdag().getMiddag().getVak().getVakId()}"></td>
                <td th:text="${week.getVrijdag().getMiddag().getVak().getVakNaam()}" id="vakVrM" th:value="${week.getVrijdag().getMiddag().getVak().getVakId()}"></td>
            </tr>
            <tr>
                <td><select id="maMid" th:name="maMid" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${MAM}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="diMid" th:name="diMid" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${DIM}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="woMid" th:name="woMid" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${WOM}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="doMid" th:name="doMid" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${DOM}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="vrMid" th:name="vrMid" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${VRM}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
            </tr>
            <tr>
                <td rowspan="2" th:value="avond">17:00 - 21:00</td>
                <td th:text="${week.getMaandag().getAvond().getVak().getVakNaam()}" id="vakMaA" th:value="${week.getMaandag().getAvond().getVak().getVakId()}"></td>
                <td th:text="${week.getDinsdag().getAvond().getVak().getVakNaam()}" id="vakDiA" th:value="${week.getDinsdag().getAvond().getVak().getVakId()}"></td>
                <td th:text="${week.getWoensdag().getAvond().getVak().getVakNaam()}" id="vakWoA" th:value="${week.getWoensdag().getAvond().getVak().getVakId()}"></td>
                <td th:text="${week.getDonderdag().getAvond().getVak().getVakNaam()}" id="vakDoA" th:value="${week.getDonderdag().getAvond().getVak().getVakId()}"></td>
                <td th:text="${week.getVrijdag().getAvond().getVak().getVakNaam()}" id="vakVrA" th:value="${week.getVrijdag().getAvond().getVak().getVakId()}"></td>
            </tr>
            <tr>
                <td><select id="maAvo" th:name="maAvo" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${MAA}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="diAvo" th:name="diAvo" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${DIA}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="woAvo" th:name="woAvo" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${WOA}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="doAvo" th:name="doAvo" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${DOA}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
                <td><select id="vrAvo" th:name="vrAvo" onchange="this.className=this.options[this.selectedIndex].className">
                    <option th:each="docent: ${VRA}" th:value="${docent.getId()}" th:text="${docent.getFirstName() + ' ' + docent.getLastName()}" th:name="${docent.getId()}">
                </select></td>
            </tr>
            </tbody>
        </table>
        <br>
        <input id="knopOpslaan" type="submit" value="Opslaan"/>
        <br>
        <br>
</form>
    </div>
</th:block>

<br>
<!--<button id="knopVorigeWeek" onclick="displayVorigeWeekButton();displayVolgendeWeekButton();subtractIndex();addWeekNumber();">Vorige Week</button>      <button id="knopVolgendeWeek" onclick="displayVolgendeWeekButton();displayVorigeWeekButton();addIndex();addWeekNumber();">Volgende Week</button>-->

<script>
    var coll = document.getElementsByClassName("collapsible");
    // var selectedWeek = document.getElementById("weekId").value;
    var i;

    for (i = 0; i < coll.length; i++) {
        coll[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var content = this.nextElementSibling;
            if (content.style.maxHeight){
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });
    }
</script>

</body>

<script>


    var VOORKEUR = 0;
    var USER = 1;
    var VAK = 2;

    //De trojaanse string wordt opgehaald en gesplitst in Vookeur-objectcombinaties.
    var voorkeuren = document.getElementById("voorkeuren").getAttribute("value");
    var gesplitsteVoorkeuren = voorkeuren.split(",");


    var selectors = window.document.getElementsByTagName("select");
    // window.document.getElementsByTagName("option").classList.add('lieverniet');

    for (var j = 0; j < selectors.length; j++) {
        getVoorkeuren(selectors[j]);
    }
    function getVoorkeuren(tagname) {
        //De voorkeurskleur wordt pas bij mouseover gegenereerd.
        //De onderstaande vars zijn nodig om de id van de vaknaam boven de SELECT op te halen. Deze is nodig om met de
        //vakId in de Voorkeurscombinatie op te halen.
        var selector = tagname;
        var parent1 = selector.parentNode;
        var parent1CellIndex = parent1.cellIndex;
        var parent2 = parent1.parentNode;
        var vorigeTableRow = parent2.previousElementSibling;
        var kiendjes = vorigeTableRow.childNodes;
        var kiendjeBoven = kiendjes[krijgPrevNodeIndex(parent1CellIndex)];
        var checkVakValue = kiendjeBoven.getAttribute('value');
        var opties = selector.options;

        // if (selector.tagName === 'SELECT') {
            //Hier worden de Voorkeurscombi's opgesplitst.
            for (var i = 0; i < gesplitsteVoorkeuren.length; i++) {
                var voorkeurgroep = gesplitsteVoorkeuren[i].split("_");
                var voorkeur = voorkeurgroep[VOORKEUR];
                var user = voorkeurgroep[USER];
                var vak = voorkeurgroep[VAK];

                toonVoorkeur(voorkeur, user, vak, checkVakValue, opties);
            }
        // }
        // for (var j = 0; j < opties.length; j++) {
        //     if (opties[j].className === undefined) {
        //         opties[j].classList.add('geenkeuze');
        //     }
        // }
    };

    function krijgPrevNodeIndex(index) {
        //Deze curieuze berekening is nodig omdat het aantal childnodes in de vak-regels in de tabel hoger is:
        //ook de lege tekstvelden worden in de childnode-array opgenomen.
        return (index + 1) * 2 + 1;
    }

    function toonVoorkeur(voorkeur, user, vak, checkVak, opties) {
        if (vak === checkVak) {
            if (voorkeur == 3) {
                voorkeurAanhechten(voorkeur, opties, user, 'graag');
            } else if (voorkeur == 2) {
                voorkeurAanhechten(voorkeur, opties, user, 'mwa');
            } else if (voorkeur == 1) {
                voorkeurAanhechten(voorkeur, opties, user, 'lieverniet');
            }
                else {
                voorkeurAanhechten(0, opties, user, 'geenkeuze');
            }
        }
    }

    function voorkeurAanhechten(voorkeur, opties, user, voorkeursklasse) {
        for (var j = 0; j < opties.length; j++) {
            if (opties[j].value == user) {
                opties[j].classList.add(voorkeursklasse);
                if (voorkeur > 0) {
                    opties[j].innerHTML = voorkeur + ": " + opties[j].innerHTML;
                } else {}
            }
        }
    }

    function getWeek() {
        var weekId = document.getElementById("weekId").value;
        var url = "/ajax/roosteraar/docent-koppelen-gekozen-cohort/" + weekId;
        console.log("dit is de url: " + url);

        var xhttp;
        if (index == "") {
            document.getElementById("index").innerHTML = "";
            return;
        }
        xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                document.getElementById("voorkeurGebruiker").value = this.responseText;
            }
        };
        xhttp.open("POST", url, true);
        xhttp.send();
    }
    getWeek();

    var index;
    index = document.getElementById("index").value;
    console.log("indexwaarde: " + index);

    var huidigeWeek;
    huidigeWeek = document.getElementById("huidigeWeek").value;
    console.log("huidige week: " + huidigeWeek);

    var startWeek;
    startWeek = document.getElementById("startWeek").value;
    console.log("startweek = " + startWeek);

    var eindWeek;
    eindWeek = document.getElementById("eindWeek").value;
    console.log("eindweek = " + eindWeek);

    function addIndex() {
        if (document.getElementById("knopVolgendeWeek").onclick) {
            index++;
            huidigeWeek++;
            console.log("i: " + index);
            console.log("hw: " + huidigeWeek);
        }
    }

    function subtractIndex() {
        if (document.getElementById("knopVorigeWeek").onclick) {
            index--;
            huidigeWeek--;
            console.log("i: " + index);
            console.log("hw: " + huidigeWeek);
        }
    }

    function addWeekNumber() {
        var x = document.getElementById("weekNummerHeader");
        x.innerText = huidigeWeek;
    }

    function displayVorigeWeekButton() {
        if (index > -1) {
            document.getElementById("knopVorigeWeek").style.display = "inline";
        } else {
            document.getElementById("knopVorigeWeek").style.display = "none";
        }
    }

    function displayVolgendeWeekButton() {
        if (huidigeWeek == eindWeek - 1) {
            document.getElementById("knopVolgendeWeek").style.display = "none";
        } else {
            document.getElementById("knopVolgendeWeek").style.display = "inline";
        }
    }

</script>
</html>


